## 3.1 数据链路层概述

<font color=green>链路(Link)</font>就是从一个结点到相邻结点的一段物理线路，而中间没有任何其他的交换结点。

<font color=green>数据链路(Data Link)</font>是指把实现通信协议的硬件和软件加到链路上，就构成了数据链路。

数据链路层以<font color=red>帧</font>为单位传输和处理数据。

数据链路层的三个问题（对于使用点对点信道的数据链路层）：

- 封装成帧
- 差错检测
- 可靠传输

## 3.2 封装成帧

<font color=green>封装成帧</font>是指数据链路层给上层交付的协议数据单元添加帧头和帧尾使之成为帧。

- 帧头和帧尾中包含有重要的控制信息。
- 帧头和帧尾的作用之一就是帧定界，为方便接收方的数据链路层从物理层交付的比特流中提取出一个个的帧。

> PPP帧里面就包含了一个帧定界标志，方便识别一个个帧，但是并不是所有的数据路层的协议中都存在帧定界标志，比如以太网V2的MAC帧。那么接收方是如何从物理层中提取出一个个以太网帧呢？
>
> 以太网的数据链路层封装好帧之后将其交付给物理层，物理层会在帧前面添加一个<font color=red>8字节的前导码</font>，然后再将比特流转换为电信号发送。
>
> 
> $$
> 8字节前导码 \ = \  7字节前同步码 \  + \  1字节帧开始定界符
> $$
> 
>
> 前同步码：使接收方时钟同步
>
> 帧开始定界符：表明后面紧跟着的为MAC帧

<font color=green>透明传输</font>是指数据链路层对上层交付的传输数据没有任何限制，就好像数据链路层不存在一样。

- 面向宇节的物理链路使用字节填充(或称字符填充）的方法实现透明传输。

- 面向比特的物理链路使用比特填充的方法实现透明传输。

![](https://cdn.jsdelivr.net/gh/LuciferCCC/blogs_images@main/20230301214758.png)

比如如下一个帧，控制子段中仅表示出了帧定界符，但是数据中同样包含与帧定界符相同的子段，为了使帧定界符唯一，就在数据中<font color=red>每5个1后面添加一个0</font>来确保帧定界符的唯一性即可。

为了提高帧的传输效率，应当<font color=red>使帧的数据部分的长度尽可能大些</font>。

考虑到差错控制等多种因素，每一种数据链路层协议都规定了帧的数据部分的长度上限，即<font color=red>最大传送单元MTU(Maximum Transfer Unit) </font>。

## 3.3 差错检测

实际的通信链路都不是理想的，比特在传输过程中可能会产生差错：1可能会变成0，而0也可能变成1。这称为<font color=red>比特差错</font>。

﻿﻿在一段时间内，传输错误的比特占所传输比特总数的比率称为<font color=red>误码率BER(Bit Error Rate)</font>。

使用差错检测码来检测数据在传输过程中是否产生了比特差错，是数据链路层所要解決的重要问题之一。

### (1). 奇偶校验

在待发送的数据后面添加1位奇偶校验位，使整个数据（包括所添加的校验位在内）中 “1” 的个数

为奇数（奇校验）或偶数（偶校验）。

- 如果有奇数个位发生误码，则奇偶性发生变化，可以检查出误码；
- 如果有偶数个位发生误码，则奇偶性不发生变化，不能检查出误码（漏检）；

![](https://cdn.jsdelivr.net/gh/LuciferCCC/blogs_images@main/20230301215538.png)

### (2). 循环荣誉校验CRC（Cyclic Redundancy Check）

收发双方约定好一个<font color=red>生成多项式 G(x)</font>；

发送方基于待发送的数据和生成多项式计算出差错检测码（<font color=red>冗余码</font>），将其添加到待传输数据的后面一起传输；

接收方通过生成多项式来计算收到的数据是否产生了误码；

![](https://cdn.jsdelivr.net/gh/LuciferCCC/blogs_images@main/20230301221616.png)

<font color=red>检错码</font>只能检测出帧在传输过程中出现了差错，但并不能定位错误，因此<font color=red>无法纠正错误</font>。

要想纠正传输中的差错，可以使用元余信息更多的<font color=red>纠错码</font>进行前向纠错。但纠错码的开销比较大，在计算机网络中较少使用。

循环冗余校验CRC有很好的检错能力（<font color=red>漏检率非常低</font>），虽然计算比较复杂，但非常易于用硬件实现，因此被广泛应用于数据链路层。

﻿在计算机网络中通常采用我们后续课程中将要讨论的检错重传方式来纠正传输中的差错，或者仅仅是丢弃检测到差错的帧，这取决于数据链路层向其上层提供的是可靠传输服务还是不可靠传输服务。